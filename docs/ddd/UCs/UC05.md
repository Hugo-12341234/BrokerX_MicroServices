# UC-05 — Placement d’un ordre (marché/limite) avec contrôles pré-trade

## Objectif
Offrir aux clients la possibilité de soumettre des ordres d’achat ou de vente (marché ou limite), soumis à des contrôles pré-trade automatisés, afin d’assurer la conformité et la sécurité des opérations sur BrokerX.

## Acteur principal
Client

## Acteurs secondaires
Moteur de Règles Pré-trade, Comptes/Portefeuilles

## Déclencheur
Le Client soumet un ordre.

## Pré-conditions
Session valide, portefeuille existant.

## Postconditions (succès)
- Ordre accepté et placé dans le carnet interne.

## Postconditions (échec)
- Ordre rejeté avec raison.

## Flux principal
1. Le Client entre le symbole, le sens (ACHAT/VENTE), le type (MARCHE/LIMITE), la quantité, le prix (si limite) et la durée (DAY/IOC/FOK).
2. Le Système normalise les données et horodate l’opération (timestamp système en UTC avec millisecondes).
3. Le Système effectue les contrôles pré-trade :
   - Pouvoir d’achat et marge disponible
   - Règles de prix (bandes, tick size)
   - Interdictions (short-sell n'est pas autorisé)
   - Limites par utilisateur (taille maximales d’ordre)
   - Vérifications de cohérence (quantité > 0)
4. Si tous les contrôles sont validés, le Système attribue un clientOrderId et persiste l’ordre.

## Alternatifs / Exceptions
A1. **Type Marché** : Le prix n’est pas requis, routage immédiat.\
E1. **Pouvoir d’achat insuffisant** : L’ordre est rejeté avec le motif correspondant.\
E2. **Violation bande de prix** : L’ordre est rejeté avec le motif correspondant.\
E3. **Idempotence** : Si un ordre avec le même clientOrderId est reçu, le Système renvoie le résultat précédent.\
E4. **Prix limite absent pour ordre limite** : L'ordre n'est pas effectué et le Client est informé.\
E5. **Quantité non positive** : L’ordre n'est pas effectué et le Client est informé.\
E6. **Short-sell non autorisé** : L’ordre est rejeté avec le motif correspondant.\
E7. **Tick size non respecté** : L’ordre est rejeté si le prix ne respecte pas l’incrément minimal autorisé.\
E8. **Taille maximale d’ordre dépassée** : L’ordre est rejeté si la quantité dépasse la limite autorisée pour l’utilisateur.\

---
**Critère d’acceptation** :
Un client soumet un ordre valide pour le stock "TEST", tous les contrôles pré-trade sont passés, l’ordre est accepté et enregistré dans le carnet interne.
